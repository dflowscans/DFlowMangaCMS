@using MangaReader.Models
@{
    ViewData["Title"] = "My Profile";
    var user = ViewBag.User as User;
    var bookmarks = ViewBag.Bookmarks as List<UserBookmark>;
    var currentStatus = ViewBag.CurrentStatus as string;
    var unlockedDecorations = ViewBag.UnlockedDecorations as List<int> ?? new List<int>();
    var unlockedTitles = ViewBag.UnlockedTitles as List<int> ?? new List<int>();
}

<div class="container-fluid py-4">
    <div class="row mb-4">
        <div class="col-12">
            <h1 class="gradient-text mb-2" style="color: #ffffff;">
                <i class="fas fa-user-circle me-2"></i>@user?.Username's Profile
            </h1>
            <div class="d-flex align-items-center gap-3">
                @{
                    var profileAvatarUrl = string.IsNullOrWhiteSpace(user?.AvatarUrl) 
                        ? $"https://ui-avatars.com/api/?name={user?.Username}&background=random&color=fff" 
                        : user.AvatarUrl;
                    var equippedDec = user?.EquippedDecoration;
                    var equippedTitle = user?.EquippedTitle;
                }
                <div class="position-relative d-flex align-items-center justify-content-center" style="width:80px; height:80px;">
                    <img src="@profileAvatarUrl" alt="Avatar" style="width:100%; height:100%; border-radius:50%; object-fit:cover; border:2px solid var(--border-color); z-index: 1; position: relative;" />
                    @if (equippedDec != null && ViewBag.EnableDecorations == "true")
                    {
                        <img src="@equippedDec!.ImageUrl" alt="Decoration" style="position: absolute; top: 50%; left: 50%; width: 120%; height: 120%; transform: translate(-50%, -50%); pointer-events: none; z-index: 2;" />
                    }
                </div>
                <div class="col-md">
                    <div class="d-flex align-items-center gap-3 mb-1">
                        <h2 class="mb-0">@user?.Username</h2>
                        <a href="@Url.Action("PublicProfile", "Auth", new { id = user?.Id })" class="btn btn-sm btn-outline-primary" style="border-radius: 20px; font-size: 0.75rem;">
                            <i class="fas fa-external-link-alt me-1"></i>View Public Profile
                        </a>
                    </div>
                    @if (equippedTitle != null && ViewBag.EnableTitles == "true")
                    {
                        <div class="mb-2">
                            <span class="badge" style="background: rgba(0,0,0,0.2); border: 1px solid @(equippedTitle!.Color ?? "transparent"); color: @(equippedTitle!.Color ?? "inherit"); font-weight: bold; font-size: 0.9rem; padding: 4px 10px;">
                                @equippedTitle!.Name
                            </span>
                        </div>
                    }
                    <div class="d-flex align-items-center gap-2 mt-2">
                        <span class="badge bg-primary">Level @user?.Level</span>
                        <div class="progress" style="height: 10px; width: 150px; background: var(--bg-tertiary); border-radius: 5px; margin-bottom: 0;">
                            <div class="progress-bar progress-bar-striped progress-bar-animated" role="progressbar" 
                                 style="width: @ViewBag.XpProgress%; background: linear-gradient(90deg, #6366f1, #ec4899);" 
                                 aria-valuenow="@user?.XP" aria-valuemin="0" aria-valuemax="@ViewBag.XpToNextLevel"></div>
                        </div>
                        <small class="text-white-50">@user?.XP / @ViewBag.XpToNextLevel XP</small>
                    </div>
                    <p class="text-white-50 mb-0 small mt-1">Member since @user?.CreatedAt.ToString("MMMM yyyy")</p>
                </div>
            </div>
            <form asp-action="UpdateProfile" method="post" enctype="multipart/form-data" class="mt-3">
                @Html.AntiForgeryToken()
                <div class="row align-items-center">
                    <div class="col-md-6 mb-3 mb-md-0">
                        <label class="form-label text-white-50 small mb-1">Update Avatar</label>
                        <div class="input-group">
                            <input type="file" name="avatar" accept=".jpg,.jpeg,.png,.webp,.gif" class="form-control" style="background: var(--bg-tertiary); border-color: var(--border-color); color: var(--text-primary);" />
                            <button type="submit" class="btn btn-primary">Update Profile</button>
                        </div>
                        <small class="text-white-50">Max 5MB. JPG/PNG/WEBP/GIF.</small>
                    </div>
                    <div class="col-md-6">
                        <div class="form-check form-switch custom-switch mt-md-4">
                            <input class="form-check-input" type="checkbox" name="hideReadingList" id="hideReadingList" value="true" @(user?.HideReadingList == true ? "checked" : "")>
                            <label class="form-check-label text-white" for="hideReadingList">
                                <i class="fas fa-lock me-1"></i>Hide Reading List from Public
                            </label>
                            <p class="text-white-50 small mb-0">When enabled, other users won't see your bookmarks on your public profile.</p>
                        </div>
                    </div>
                </div>
            </form>
        </div>
    </div>

    <style>
        .custom-switch .form-check-input {
            width: 3em;
            height: 1.5em;
            cursor: pointer;
            background-color: var(--bg-tertiary);
            border-color: var(--border-color);
        }
        .custom-switch .form-check-input:checked {
            background-color: #6366f1;
            border-color: #6366f1;
        }
        .custom-switch .form-check-label {
            cursor: pointer;
            padding-left: 0.5rem;
            font-weight: 500;
        }
    </style>

    <!-- Decoration & Title Management -->
    @if (ViewBag.EnableDecorations == "true" || ViewBag.EnableTitles == "true")
    {
        <div class="row mb-4">
            @if (ViewBag.EnableDecorations == "true")
            {
                <div class="@(ViewBag.EnableTitles == "true" ? "col-md-6" : "col-12") mb-4 mb-md-0">
                    <div class="card h-100" style="background: var(--bg-secondary); border: 1px solid var(--border-color);">
                        <div class="card-header d-flex justify-content-between align-items-center" style="background: var(--bg-tertiary); border-bottom: 1px solid var(--border-color);">
                            <h4 class="mb-0 text-white"><i class="fas fa-pencil-alt me-2"></i>PFP Decorations</h4>
                            <span class="badge bg-primary">Unlocked: @((ViewBag.AvailableDecorations as List<PfpDecoration>)?.Count(d => (user?.Level >= d.LevelRequirement && !d.IsLocked) || unlockedDecorations.Contains(d.Id)) ?? 0)</span>
                        </div>
                        <div class="card-body">
                            <div class="decoration-grid">
                                <div class="decoration-item @(user?.EquippedDecorationId == null ? "active" : "")" onclick="equipDecoration(0)">
                                    <div class="decoration-preview">
                                        <img src="@profileAvatarUrl" alt="No Decoration" />
                                    </div>
                                    <div class="decoration-info">
                                        <p class="mb-0 text-white">None</p>
                                    </div>
                                </div>
                                @if (ViewBag.AvailableDecorations is List<PfpDecoration> decs)
                                {
                                    foreach (var dec in decs)
                                    {
                                        bool isAwarded = unlockedDecorations.Contains(dec.Id);
                                        bool isUnlocked = !dec.IsLocked || isAwarded;
                                        bool canEquip = (user?.Level >= dec.LevelRequirement && !dec.IsLocked) || isAwarded;
                                        
                                        <div class="decoration-item @(user?.EquippedDecorationId == dec.Id ? "active" : "") @(!canEquip ? "locked" : "")" 
                                             onclick="@(canEquip ? $"equipDecoration({dec.Id})" : "")">
                                            <div class="decoration-preview">
                                                <img src="@profileAvatarUrl" alt="Avatar" />
                                                @if (canEquip)
                                                {
                                                    <img src="@dec.ImageUrl" class="dec-overlay" alt="@dec.Name" />
                                                }
                                                else
                                                {
                                                    <div class="lock-overlay">
                                                        <i class="fas fa-lock"></i>
                                                        @if (user?.Level < dec.LevelRequirement)
                                                        {
                                                            <span>Lvl @dec.LevelRequirement</span>
                                                        }
                                                        else
                                                        {
                                                            <span>Locked</span>
                                                        }
                                                    </div>
                                                }
                                            </div>
                                            <div class="decoration-info">
                                                <p class="mb-0 text-white">@dec.Name</p>
                                                @if (isAwarded)
                                                {
                                                    <span class="badge bg-warning text-dark" style="font-size: 0.6rem;">Awarded</span>
                                                }
                                            </div>
                                        </div>
                                    }
                                }
                            </div>
                        </div>
                    </div>
                </div>
            }

            @if (ViewBag.EnableTitles == "true")
            {
                <div class="@(ViewBag.EnableDecorations == "true" ? "col-md-6" : "col-12")">
                    <div class="card h-100" style="background: var(--bg-secondary); border: 1px solid var(--border-color);">
                        <div class="card-header d-flex justify-content-between align-items-center" style="background: var(--bg-tertiary); border-bottom: 1px solid var(--border-color);">
                            <h4 class="mb-0 text-white"><i class="fas fa-tag me-2"></i>User Titles</h4>
                            <span class="badge bg-primary">Unlocked: @((ViewBag.AvailableTitles as List<UserTitle>)?.Count(t => (user?.Level >= t.LevelRequirement && !t.IsLocked) || unlockedTitles.Contains(t.Id)) ?? 0)</span>
                        </div>
                        <div class="card-body">
                            <div class="title-grid">
                                <div class="title-item @(user?.EquippedTitleId == null ? "active" : "")" onclick="equipTitle(0)">
                                    <div class="title-preview-box" style="border-color: #ffffff; color: #ffffff;">
                                        None
                                    </div>
                                    <p class="mb-0 small mt-1 text-white-50">Remove Title</p>
                                </div>
                                @if (ViewBag.AvailableTitles is List<UserTitle> titles)
                                {
                                    foreach (var title in titles)
                                    {
                                        bool isAwarded = unlockedTitles.Contains(title.Id);
                                        bool isUnlocked = !title.IsLocked || isAwarded;
                                        bool canEquip = (user?.Level >= title.LevelRequirement && !title.IsLocked) || isAwarded;
                                        
                                        <div class="title-item @(user?.EquippedTitleId == title.Id ? "active" : "") @(!canEquip ? "locked" : "")" 
                                             onclick="@(canEquip ? $"equipTitle({title.Id})" : "")">
                                            <div class="title-preview-box @(!canEquip ? "locked" : "")" style="border-color: @title.Color; color: @title.Color;">
                                                @if (!canEquip)
                                                {
                                                    <i class="fas fa-lock me-1"></i>
                                                    @if (user?.Level < title.LevelRequirement)
                                                    {
                                                        <span>Lvl @title.LevelRequirement</span>
                                                    }
                                                    else
                                                    {
                                                        <span>Locked</span>
                                                    }
                                                }
                                                else
                                                {
                                                    @title.Name
                                                }
                                            </div>
                                            @if (canEquip)
                                            {
                                                <div class="d-flex flex-column align-items-center">
                                                    <p class="mb-0 small mt-1 text-white-50">@title.Name</p>
                                                    @if (isAwarded)
                                                    {
                                                        <span class="badge bg-warning text-dark" style="font-size: 0.6rem;">Awarded</span>
                                                    }
                                                </div>
                                            }
                                        </div>
                                    }
                                }
                            </div>
                        </div>
                    </div>
                </div>
            }
        </div>
    }

    <!-- Bookmark Statistics -->
    <div class="row g-3 mb-4">
        <div class="col-md-2">
            <a href="@Url.Action("Profile", "Auth", new { status = "PlanToRead" })" 
               class="stat-card @(currentStatus == "PlanToRead" ? "active" : "")">
                <div class="stat-icon" style="background: linear-gradient(135deg, #667eea, #764ba2);">
                    <i class="fas fa-bookmark"></i>
                </div>
                <div class="stat-info">
                    <div class="stat-number">@ViewBag.PlanToReadCount</div>
                    <div class="stat-label">Plan to Read</div>
                </div>
            </a>
        </div>
        <div class="col-md-2">
            <a href="@Url.Action("Profile", "Auth", new { status = "Reading" })" 
               class="stat-card @(currentStatus == "Reading" ? "active" : "")">
                <div class="stat-icon" style="background: linear-gradient(135deg, #f093fb, #f5576c);">
                    <i class="fas fa-book-open"></i>
                </div>
                <div class="stat-info">
                    <div class="stat-number">@ViewBag.ReadingCount</div>
                    <div class="stat-label">Reading</div>
                </div>
            </a>
        </div>
        <div class="col-md-2">
            <a href="@Url.Action("Profile", "Auth", new { status = "Completed" })" 
               class="stat-card @(currentStatus == "Completed" ? "active" : "")">
                <div class="stat-icon" style="background: linear-gradient(135deg, #4facfe, #00f2fe);">
                    <i class="fas fa-check-circle"></i>
                </div>
                <div class="stat-info">
                    <div class="stat-number">@ViewBag.CompletedCount</div>
                    <div class="stat-label">Completed</div>
                </div>
            </a>
        </div>
        <div class="col-md-2">
            <a href="@Url.Action("Profile", "Auth", new { status = "OnHold" })" 
               class="stat-card @(currentStatus == "OnHold" ? "active" : "")">
                <div class="stat-icon" style="background: linear-gradient(135deg, #fa709a, #fee140);">
                    <i class="fas fa-pause-circle"></i>
                </div>
                <div class="stat-info">
                    <div class="stat-number">@ViewBag.OnHoldCount</div>
                    <div class="stat-label">On Hold</div>
                </div>
            </a>
        </div>
        <div class="col-md-2">
            <a href="@Url.Action("Profile", "Auth", new { status = "Dropped" })" 
               class="stat-card @(currentStatus == "Dropped" ? "active" : "")">
                <div class="stat-icon" style="background: linear-gradient(135deg, #a8a8a8, #6c757d);">
                    <i class="fas fa-times-circle"></i>
                </div>
                <div class="stat-info">
                    <div class="stat-number">@ViewBag.DroppedCount</div>
                    <div class="stat-label">Dropped</div>
                </div>
            </a>
        </div>
        <div class="col-md-2">
            <a href="@Url.Action("Profile", "Auth")" 
               class="stat-card @(string.IsNullOrEmpty(currentStatus) ? "active" : "")">
                <div class="stat-icon" style="background: linear-gradient(135deg, #6366f1, #ec4899);">
                    <i class="fas fa-list"></i>
                </div>
                <div class="stat-info">
                    <div class="stat-number">@ViewBag.AllCount</div>
                    <div class="stat-label">All</div>
                </div>
            </a>
        </div>
    </div>

    <!-- Bookmarks Grid -->
    <div class="row">
        <div class="col-12">
            <div class="d-flex justify-content-between align-items-center mb-3">
                <h3 class="mb-0">
                    @if (!string.IsNullOrEmpty(currentStatus))
                    {
                        <span>@currentStatus.Replace("PlanToRead", "Plan to Read").Replace("OnHold", "On Hold")</span>
                    }
                    else
                    {
                        <span>All Bookmarks</span>
                    }
                </h3>
                <div class="d-flex gap-2">
                    @if (!string.IsNullOrEmpty(currentStatus))
                    {
                        <a href="@Url.Action("Profile", "Auth")" class="btn btn-sm btn-secondary">
                            <i class="fas fa-times me-1"></i>Clear Filter
                        </a>
                    }
                    <div class="dropdown">
                        <button class="btn btn-sm btn-info dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false">
                            <i class="fas fa-sync-alt me-1"></i>AniList Sync
                        </button>
                        <ul class="dropdown-menu dropdown-menu-end dropdown-menu-dark" style="background: var(--bg-secondary); border: 1px solid var(--border-color);">
                            <li>
                                <a class="dropdown-item" href="@Url.Action("ExportAniListXml", "Auth")">
                                    <i class="fas fa-file-export me-2"></i>Export for AniList
                                </a>
                            </li>
                            <li><hr class="dropdown-divider" style="border-color: var(--border-color);"></li>
                            <li>
                                <button class="dropdown-item" type="button" data-bs-toggle="modal" data-bs-target="#importModal">
                                    <i class="fas fa-file-import me-2"></i>Import from AniList/MAL
                                </button>
                            </li>
                        </ul>
                    </div>
                </div>
            </div>

            <!-- Import Modal -->
            <div class="modal fade" id="importModal" tabindex="-1" aria-labelledby="importModalLabel" aria-hidden="true">
                <div class="modal-dialog">
                    <div class="modal-content" style="background: var(--bg-secondary); color: var(--text-primary); border: 1px solid var(--border-color);">
                        <div class="modal-header" style="border-bottom-color: var(--border-color);">
                            <h5 class="modal-title" id="importModalLabel">Import Reading List</h5>
                            <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
                        </div>
                        <form asp-action="ImportAniListXml" method="post" enctype="multipart/form-data">
                            <div class="modal-body">
                                <p class="small text-muted mb-3">Upload your MyAnimeList or AniList export file (XML format). We will try to match the titles with our database.</p>
                                <div class="mb-3">
                                    <label for="xmlFile" class="form-label">Select XML File</label>
                                    <input type="file" class="form-control" id="xmlFile" name="xmlFile" accept=".xml" required
                                           style="background: var(--bg-tertiary); border-color: var(--border-color); color: var(--text-primary);">
                                </div>
                            </div>
                            <div class="modal-footer" style="border-top-color: var(--border-color);">
                                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                                <button type="submit" class="btn btn-primary">Start Import</button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>

            @if (bookmarks != null && bookmarks.Any())
            {
                <div class="row g-3">
                    @foreach (var bookmark in bookmarks)
                    {
                        var manga = bookmark.Manga;
                        
                        <div class="col-md-6 col-lg-3">
                            <div class="manga-card">
                                <a href="@Url.Action("Detail", "Series", new { id = manga?.Id })" class="card-image-link">
                                    <div class="manga-image">
                                        <img src="@manga?.ImageUrl" alt="@manga?.Title">
                                        <div class="bookmark-badge @bookmark!.Status.ToString().ToLower()">
                                            @bookmark!.Status.ToString().Replace("PlanToRead", "Plan to Read").Replace("OnHold", "On Hold")
                                        </div>
                                    </div>
                                </a>
                                <div class="manga-info">
                                    <h5 class="manga-title">
                                        <a href="@Url.Action("Detail", "Series", new { id = manga?.Id })">@manga?.Title</a>
                                    </h5>
                                    <p class="manga-author" style="color: #ffffff; opacity: 0.8;">@manga?.Author</p>
                                    <p style="color: #ffffff; font-size: 0.85rem; margin-bottom: 0.5rem;">
                                        <i class="fas fa-clock me-1"></i>Updated @bookmark!.UpdatedAt.ToString("MMM dd, yyyy")
                                    </p>
                                    <div class="d-flex gap-2 mt-2">
                                        <a href="@Url.Action("Detail", "Series", new { id = manga?.Id })" class="btn btn-sm btn-primary flex-fill">
                                            <i class="fas fa-eye me-1"></i>View
                                        </a>
                                        <select class="form-select form-select-sm flex-fill bookmark-status-select"
                                                style="background-color: var(--bg-tertiary); color: var(--text-primary); border-color: var(--border-color);"
                                                data-manga-id="@manga?.Id" data-original-value="@((int)bookmark!.Status)">
                                            @foreach (var s in Enum.GetValues<BookmarkStatus>())
                                            {
                                                <option value="@((int)s)" selected="@(s == bookmark!.Status)">@s</option>
                                            }
                                            <option value="-1">Remove</option>
                                        </select>
                                    </div>
                                </div>
                            </div>
                        </div>
                    }
                </div>
            }
            else
            {
                <div class="text-center py-5">
                    <i class="fas fa-inbox" style="font-size: 3rem; color: var(--text-muted); margin-bottom: 1rem;"></i>
                    <h4 class="text-muted">No bookmarks found</h4>
                    <p class="text-muted">Start adding manga to your bookmarks!</p>
                    <a href="@Url.Action("Index", "Series")" class="btn btn-primary mt-3">
                        <i class="fas fa-search me-2"></i>Browse Manga
                    </a>
                </div>
            }
        </div>
    </div>
</div>

<style>
    .decoration-grid, .title-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(100px, 1fr));
        gap: 1rem;
    }

    .decoration-item, .title-item {
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        cursor: pointer;
        text-align: center;
        padding: 1rem;
        border-radius: 12px;
        background: var(--bg-secondary);
        border: 2px solid var(--border-color);
        transition: all 0.3s ease;
        height: 100%;
    }

    .decoration-item:hover:not(.locked), .title-item:hover:not(.locked) {
        transform: translateY(-5px);
        background: var(--bg-tertiary);
        border-color: var(--primary-light);
    }

    .decoration-item.active, .title-item.active {
        border-color: var(--primary-color);
        background: var(--bg-tertiary);
        box-shadow: 0 0 15px rgba(99, 102, 241, 0.4);
    }

    .decoration-item.locked, .title-item.locked {
        cursor: not-allowed;
        opacity: 0.6;
    }

    .decoration-preview {
        width: 80px;
        height: 80px;
        position: relative;
        display: flex;
        align-items: center;
        justify-content: center;
        margin-bottom: 0.75rem;
    }

    .decoration-preview img:first-child {
        width: 100%;
        height: 100%;
        border-radius: 50%;
        object-fit: cover;
        z-index: 1;
    }

    .dec-overlay {
        position: absolute;
        top: 50%;
        left: 50%;
        width: 120%;
        height: 120%;
        transform: translate(-50%, -50%);
        pointer-events: none;
        z-index: 2;
    }

    .lock-overlay {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0,0,0,0.6);
        border-radius: 50%;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        font-size: 0.6rem;
        color: white;
    }

    .title-preview-box {
        border: 1px solid;
        border-radius: 4px;
        padding: 4px 8px;
        font-weight: bold;
        font-size: 0.75rem;
        margin-bottom: 5px;
        background: rgba(0,0,0,0.2);
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
    }

    .title-preview-box.locked {
        border-color: #666 !important;
        color: #666 !important;
    }

    .stat-card {
        display: flex;
        align-items: center;
        gap: 1rem;
        padding: 1.5rem;
        background: var(--bg-secondary);
        border: 2px solid var(--border-color);
        border-radius: 10px;
        text-decoration: none;
        transition: all 0.3s ease;
        height: 100%;
    }

    .stat-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 10px 30px rgba(99, 102, 241, 0.2);
        border-color: var(--primary-color);
    }

    .stat-card.active {
        border-color: var(--primary-color);
        box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.2);
    }

    .stat-icon {
        width: 50px;
        height: 50px;
        display: flex;
        align-items: center;
        justify-content: center;
        border-radius: 10px;
        color: white;
        font-size: 1.5rem;
        flex-shrink: 0;
    }

    .stat-info {
        flex: 1;
    }

    .stat-number {
        font-size: 1.75rem;
        font-weight: 700;
        color: var(--text-primary);
        line-height: 1;
    }

    .stat-label {
        font-size: 0.85rem;
        color: #ffffff;
        margin-top: 0.25rem;
    }

    .manga-card {
        background: var(--bg-secondary);
        border: 1px solid var(--border-color);
        border-radius: 10px;
        overflow: hidden;
        transition: all 0.3s ease;
        height: 100%;
        display: flex;
        flex-direction: column;
    }

    .manga-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 10px 30px rgba(99, 102, 241, 0.2);
    }

    .card-image-link {
        text-decoration: none;
        display: block;
    }

    .manga-image {
        aspect-ratio: 3/4;
        overflow: hidden;
        position: relative;
        background: var(--bg-tertiary);
    }

    .manga-image img {
        width: 100%;
        height: 100%;
        object-fit: cover;
        transition: transform 0.3s ease;
    }

    .manga-card:hover .manga-image img {
        transform: scale(1.05);
    }

    .bookmark-badge {
        position: absolute;
        top: 0.5rem;
        right: 0.5rem;
        padding: 0.4rem 0.8rem;
        border-radius: 6px;
        font-size: 0.75rem;
        font-weight: 600;
        color: white;
        text-transform: capitalize;
    }

    .bookmark-badge.plantoread {
        background: linear-gradient(135deg, #667eea, #764ba2);
    }

    .bookmark-badge.reading {
        background: linear-gradient(135deg, #f093fb, #f5576c);
    }

    .bookmark-badge.completed {
        background: linear-gradient(135deg, #4facfe, #00f2fe);
    }

    .bookmark-badge.onhold {
        background: linear-gradient(135deg, #fa709a, #fee140);
    }

    .bookmark-badge.dropped {
        background: linear-gradient(135deg, #a8a8a8, #6c757d);
    }

    .manga-info {
        padding: 1rem;
        flex: 1;
        display: flex;
        flex-direction: column;
    }

    .manga-title {
        font-size: 1rem;
        font-weight: 600;
        margin-bottom: 0.5rem;
        line-height: 1.3;
    }

    .manga-title a {
        color: var(--text-primary);
        text-decoration: none;
        transition: color 0.3s ease;
    }

    .manga-title a:hover {
        color: var(--primary-light);
    }

    .manga-author {
        font-size: 0.9rem;
        color: #ffffff;
        margin-bottom: 0.5rem;
    }
</style>

<script>
    async function removeBookmark(mangaId) {
        if (!confirm('Are you sure you want to remove this bookmark?')) {
            return;
        }
        try {
            const response = await fetch('@Url.Action("RemoveBookmark", "Series")', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ mangaId: parseInt(mangaId), status: 0 })
            });
            const data = await response.json();
            if (data.success) { location.reload(); } else { alert(data.message || 'Failed to remove bookmark'); }
        } catch (error) {
            alert('Failed to remove bookmark');
        }
    }

    document.addEventListener('DOMContentLoaded', function() {
        const selects = document.querySelectorAll('.bookmark-status-select');
        selects.forEach(select => {
            select.addEventListener('change', async function() {
                const mangaId = this.getAttribute('data-manga-id');
                const status = parseInt(this.value);
                const originalValue = this.getAttribute('data-original-value');
                this.disabled = true;
                if (status === -1) {
                    await removeBookmark(mangaId);
                } else {
                    const ok = await updateBookmark(mangaId, status);
                    if (!ok) { this.value = originalValue; }
                }
                this.disabled = false;
                location.reload();
            });
        });
    });

    async function updateBookmark(mangaId, status) {
        try {
            const response = await fetch('@Url.Action("AddBookmark", "Series")', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ mangaId: parseInt(mangaId), status: status })
            });
            const data = await response.json();
            return !!data.success;
        } catch (e) {
            return false;
        }
    }

    async function equipDecoration(decorationId) {
        try {
            const response = await fetch('@Url.Action("EquipDecoration", "Auth")', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ decorationId: decorationId })
            });
            const data = await response.json();
            if (data.success) {
                location.reload();
            } else {
                alert(data.message || 'Failed to equip decoration');
            }
        } catch (error) {
            alert('An error occurred while equipping the decoration');
        }
    }

    async function equipTitle(titleId) {
        try {
            const response = await fetch('@Url.Action("EquipTitle", "Auth")', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ titleId: titleId })
            });
            const data = await response.json();
            if (data.success) {
                location.reload();
            } else {
                alert(data.message || 'Failed to equip title');
            }
        } catch (error) {
            alert('An error occurred while equipping the title');
        }
    }
</script>

@Html.AntiForgeryToken()
